<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dive Scroll Transition</title>
<style>
  :root{
    --surfaceA:#5FC2A7;
    --surfaceB:#3CC19E;
    --underA:#2aa98d;
    --underB:#146f6a;
    --deep:#083b46;
    --ink: rgba(255,255,255,0.92);
    --shadow: 0 18px 60px rgba(0,0,0,0.45);
  }

  html,body{ margin:0; height:100%; background:#07131d; font-family:system-ui, Arial; }
  body{ overflow-x:hidden; }

  /* Tall track (the “world” you fall through) */
  .track{
    position:relative;
    height: 260vh; /* <-- increase for longer fall */
  }

  /* Sticky viewport = camera window */
  .camera{
    position:sticky;
    top:0;
    height:100vh;
    overflow:hidden;
  }

  /* Background changes as you scroll (we also animate it slightly) */
  .bg{
    position:absolute; inset:-12%;
    background:
      radial-gradient(1200px 800px at 50% -10%, rgba(255,255,255,0.22), transparent 55%),
      linear-gradient(180deg,
        var(--surfaceA) 0%,
        var(--surfaceB) 28%,
        var(--underA) 55%,
        var(--underB) 78%,
        var(--deep) 100%);
    transform: translateY(var(--bgShift, 0px)) scale(1.08);
    filter: saturate(1.12) brightness(var(--bri, 1));
    will-change: transform, filter;
  }

  /* Surface line that moves out of view quickly */
  .surfaceLine{
    position:absolute; left:-10%; right:-10%;
    top: 42%;
    height: 14px;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.9), transparent);
    opacity: var(--lineOp, 0.95);
    transform: translateY(var(--lineY, 0px));
    filter: blur(1px);
    will-change: transform, opacity;
  }

  /* Caustics shimmer */
  .caustics{
    position:absolute; inset:-30%;
    background:
      repeating-radial-gradient(circle at 20% 30%, rgba(255,255,255,0.08) 0 6px, transparent 6px 20px),
      repeating-radial-gradient(circle at 70% 60%, rgba(255,255,255,0.06) 0 7px, transparent 7px 22px);
    mix-blend-mode: overlay;
    opacity: var(--cOp, 0.0);
    transform: translateY(var(--cY, 0px)) rotate(-3deg) scale(1.08);
    filter: blur(1px);
    pointer-events:none;
  }

  .vignette{
    position:absolute; inset:0;
    background: radial-gradient(closest-side at 50% 40%, transparent 52%, rgba(0,0,0,0.46) 100%);
    opacity: 0.78;
    pointer-events:none;
  }

  /* Bubbles float up while you “fall” down */
  .bubbles{ position:absolute; inset:0; pointer-events:none; overflow:hidden; }
  .bubble{
    position:absolute;
    bottom:-20vh;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%,
      rgba(255,255,255,0.95),
      rgba(255,255,255,0.18) 55%,
      rgba(255,255,255,0.07) 100%);
    filter: blur(var(--blur));
    opacity: 0;
    animation: bubbleUp var(--dur) linear infinite;
    animation-delay: var(--delay);
    will-change: transform, opacity;
  }

  @keyframes bubbleUp{
    0%{ opacity: 0; transform: translate3d(0,0,0) scale(var(--s)); }
    10%{ opacity: var(--op); }
    100%{ opacity: 0; transform: translate3d(var(--drift), -150vh, 0) scale(calc(var(--s) * 1.18)); }
  }

  /* Text card */
  .center{
    position:absolute; inset:0;
    display:grid; place-items:center;
    z-index:4;
  }
  .card{
    padding: 14px 18px;
    border-radius: 18px;
    background: rgba(255,255,255,0.12);
    border: 1px solid rgba(255,255,255,0.18);
    box-shadow: var(--shadow);
    color: var(--ink);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    text-align:center;
    opacity: var(--tOp, 0);
    transform: translateY(var(--tY, 8px)) scale(var(--tS, .98));
    transition: opacity 240ms ease, transform 240ms ease;
  }
  .title{ font-weight: 800; }
  .sub{ font-size: 13px; opacity: .9; margin-top: 4px; }

  /* Controls */
  .controls{
    position:fixed; left:50%; bottom:18px;
    transform: translateX(-50%);
    display:flex; gap:10px;
    z-index:10;
  }
  .btn{
    padding:10px 16px;
    border:none;
    border-radius:999px;
    background:#ffffff22;
    color:white;
    cursor:pointer;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }

  /* Reduce motion */
  @media (prefers-reduced-motion: reduce){
    .bubble{ animation:none !important; display:none; }
  }
</style>
</head>
<body>

<div class="track" id="track">
  <div class="camera" id="camera">
    <div class="bg" id="bg"></div>
    <div class="caustics" id="caustics"></div>
    <div class="surfaceLine" id="surfaceLine"></div>
    <div class="bubbles" id="bubbles"></div>
    <div class="vignette"></div>

    <div class="center">
      <div class="card" id="card">
        <div class="title">Falling into the Algal Pond…</div>
        <div class="sub">Just a second — going underwater.</div>
      </div>
    </div>
  </div>
</div>

<div class="controls">
  <button class="btn" id="replay">Replay</button>
  <button class="btn" id="stop">Stop</button>
</div>

<script>
  const bubblesWrap = document.getElementById("bubbles");
  const bg = document.getElementById("bg");
  const caustics = document.getElementById("caustics");
  const surfaceLine = document.getElementById("surfaceLine");
  const card = document.getElementById("card");

  const rnd=(a,b)=>a+Math.random()*(b-a);

  // Create BIG bubbles + normal bubbles
  const COUNT = 54;
  for(let i=0;i<COUNT;i++){
    const b = document.createElement("div");
    b.className = "bubble";

    const isBig = Math.random() < 0.38;
    const size = isBig ? rnd(26, 70) : rnd(10, 28);
    b.style.width = size+"px";
    b.style.height = size+"px";
    b.style.left = rnd(-10, 110)+"vw";

    const dur = isBig ? rnd(1.0, 1.55) : rnd(1.3, 2.2);
    b.style.setProperty("--dur", dur+"s");

    b.style.setProperty("--delay", rnd(0, 1.0)+"s");
    b.style.setProperty("--drift", (isBig ? rnd(-60,60) : rnd(-34,34))+"px");
    b.style.setProperty("--s", (isBig ? rnd(1.0,1.9) : rnd(0.75,1.25)));
    b.style.setProperty("--op", (isBig ? rnd(0.65,0.92) : rnd(0.35,0.65)));
    b.style.setProperty("--blur", (isBig ? rnd(0.6,2.0) : rnd(0.2,1.0))+"px");

    bubblesWrap.appendChild(b);
  }

  // Auto-scroll down (the “fall”)
  let raf = null;
  let running = true;

  function startAutoScroll(){
    running = true;
    const startY = window.scrollY;
    const maxY = document.documentElement.scrollHeight - window.innerHeight;
    const target = Math.min(maxY, startY + window.innerHeight * 2.4); // fall distance

    const duration = 1400; // ms
    const t0 = performance.now();

    function easeInOut(t){
      return t<0.5 ? 2*t*t : 1 - Math.pow(-2*t+2,2)/2;
    }

    function tick(now){
      if(!running) return;
      const t = Math.min(1, (now - t0) / duration);
      const e = easeInOut(t);
      const y = startY + (target - startY) * e;
      window.scrollTo(0, y);

      // Update visuals based on progress
      const p = e; // 0..1
      bg.style.setProperty("--bgShift", (-p*120) + "px");     // background shifts
      bg.style.setProperty("--bri", (1 - p*0.10).toFixed(3)); // slightly darker
      surfaceLine.style.setProperty("--lineY", (-p*320) + "px");
      surfaceLine.style.setProperty("--lineOp", (1 - p*1.1).toFixed(3));
      caustics.style.setProperty("--cOp", (p < 0.65 ? (p/0.65)*0.38 : 0.22).toFixed(3));
      caustics.style.setProperty("--cY", (p*60) + "px");

      // Text shows early then fades
      const tShow = p < 0.75 ? 1 : Math.max(0, 1 - (p-0.75)/0.25);
      card.style.setProperty("--tOp", tShow.toFixed(3));
      card.style.setProperty("--tY", (8 - p*14) + "px");
      card.style.setProperty("--tS", (0.98 + p*0.03).toFixed(3));

      if(t < 1) raf = requestAnimationFrame(tick);
    }
    raf = requestAnimationFrame(tick);
  }

  function stopAutoScroll(){
    running = false;
    if(raf) cancelAnimationFrame(raf);
  }

  // Buttons
  document.getElementById("replay").addEventListener("click", ()=>{
    stopAutoScroll();
    window.scrollTo(0,0);
    // small delay so scroll reset is visible
    setTimeout(()=> startAutoScroll(), 60);
  });
  document.getElementById("stop").addEventListener("click", stopAutoScroll);

  // Start
  window.scrollTo(0,0);
  startAutoScroll();
</script>
</body>
</html>
