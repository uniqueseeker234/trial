<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Algae Identifier üåø</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>

<style>
body { margin:0; font-family: Arial, sans-serif; background: linear-gradient(to bottom, #0f9b8e, #38ef7d); overflow-x:hidden; }
/* Bubbles animation */
body::before { content:""; position:fixed; width:200%; height:200%; background-image: radial-gradient(rgba(255,255,255,0.15) 2px, transparent 2px); background-size:60px 60px; animation:bubbles 35s linear infinite; z-index:-1; }
@keyframes bubbles { 0%{transform:translateY(0);} 100%{transform:translateY(-120px);} }
/* Heading animation */
h1 { text-align:center; padding:30px 10px; color:white; font-size:42px; letter-spacing:2px; animation: floatTitle 3s ease-in-out infinite alternate; }
@keyframes floatTitle { 0%{transform:translateY(0px);} 100%{transform:translateY(-8px);} }
.container { display:flex; justify-content:center; gap:40px; padding:20px; flex-wrap:wrap; }
.card { background:white; padding:25px; border-radius:15px; box-shadow:0 10px 25px rgba(0,0,0,0.2); animation:fadeIn 1s ease; }
/* Upload box */
.upload-box { background:#f1f1f1; padding:25px; border-radius:12px; text-align:center; cursor:pointer; transition:0.3s; }
.upload-box:hover { background:#e0ffff; transform:scale(1.03);}
.result-image { max-width:250px; width:100%; border-radius:10px; margin-top:15px; display:none; }
.description { margin-top:20px; font-size:14px; }
/* Carousel */
.carousel { margin-top:15px; position:relative; width:100%; max-width:300px; }
.carousel img { width:100%; border-radius:10px; display:none; }
.carousel img.active { display:block; }
.carousel button { position:absolute; top:50%; transform:translateY(-50%); background:rgba(0,0,0,0.3); border:none; color:white; font-size:20px; padding:5px 10px; cursor:pointer; border-radius:5px; }
.prev { left:5px; } .next { right:5px; }
/* Stars */
.stars span { font-size:30px; cursor:pointer; color:gold; transition:0.2s; }
.stars span:hover { transform:scale(1.3); }
.thank-message { margin-top:10px; font-size:14px; min-height:24px; transition:0.3s; }
/* Buttons */
button { padding:10px 18px; margin:8px; border-radius:8px; border:none; cursor:pointer; font-size:14px; transition:0.3s; }
button:hover { transform:scale(1.05); }
.contribute { background:#27ae60; color:white; }
.explore { background:#2980b9; color:white; }
/* Responsive */
@media (max-width:900px){ .container{flex-direction:column; align-items:center;} }
</style>
</head>
<body>

<h1>üåø Algae Identifier</h1>

<div class="container">
<!-- LEFT -->
<div class="card">
<div class="upload-box" onclick="document.getElementById('imageUpload').click()">üåø Select your algae photo to start!</div>
<input type="file" id="imageUpload" accept="image/*" style="display:none;">
<h2 id="prediction"></h2>
<div class="carousel" id="carousel"></div>
<div id="description" class="description"></div>
</div>

<!-- RIGHT -->
<div class="card" style="text-align:center; min-width:250px;">
<div class="stars" id="stars"></div>
<div class="thank-message" id="thankMessage"></div>
<button class="contribute">Contribute</button>
<button class="explore">Explore Algae Around the World</button>
</div>
</div>

<script>
let model;
let classes = [];
const CONFIDENCE_THRESHOLD = 0.65;

// Algae info (keys match your labels; lowercase)
const algaeInfo = {
"spirogyra": {images:["images/spirogyra1.jpg","images/spirogyra2.jpg"], habit:["Filamentous freshwater green algae","Forms floating slimy masses","Has spiral chloroplasts"], economic:["Produces oxygen in ponds","Used in biological research"], location:["Found in freshwater ponds","Common in slow-moving water bodies"]},
"cladophora": {images:["images/cladophora1.jpg","images/cladophora2.jpg","images/cladophora3.jpg"], habit:["Branched filamentous green algae","Attaches to submerged surfaces","Forms dense green mats"], economic:["Provides shelter for aquatic organisms","Indicates nutrient pollution levels"], location:["Freshwater & marine habitats","Common in nutrient-rich environments"]},
"oedogonium": {images:["images/oedogonium1.jpg","images/oedogonium2.jpg"], habit:["Filamentous green algae with basal holdfast","Grows in mats or attached filaments","Prefers calm water"], economic:["Used in research and water quality monitoring","Oxygen producer in water bodies"], location:["Freshwater ponds and slow streams","Common in nutrient-rich ponds"]},
"volvox": {images:["images/volvox1.jpg","images/volvox2.jpg"], habit:["Spherical colonial green algae","Colonies with flagella","Forms motile spheres"], economic:["Used in biological experiments","Oxygen producer"], location:["Freshwater ponds and lakes","Common in nutrient-rich water"]},
"nostoc": {images:["images/nostoc1.jpg","images/nostoc2.jpg"], habit:["Cyanobacteria forming colonies","Gelatinous colonies","Filamentous structure"], economic:["Nitrogen fixation","Used in research"], location:["Freshwater and moist soils","Found on rocks and soil surfaces"]},
"pediastrum": {images:["images/pediastrum1.jpg","images/pediastrum2.jpg"], habit:["Colonial green algae","Flat star-like colonies","Planktonic in water"], economic:["Used in ecological studies","Indicator of water quality"], location:["Freshwater ponds","Common in nutrient-rich water"]},
"cosmarium": {images:["images/cosmarium1.jpg","images/cosmarium2.jpg"], habit:["Single-celled green algae with semicells","Desmids are symmetrical","Often found in colonies"], economic:["Used in ecological studies","Indicator of water quality"], location:["Freshwater habitats","Ponds and lakes with clean water"]},
"noctiluca": {images:["images/noctiluca1.jpg","images/noctiluca2.jpg"], habit:["Bioluminescent marine plankton","Single-celled","Motile with flagella"], economic:["Indicators of marine water health","Can cause red tides"], location:["Marine environments","Coastal waters worldwide"]},
"staurastrum": {images:["images/staurastrum1.jpg","images/staurastrum2.jpg"], habit:["Single-celled desmid","Star-shaped cells","Free-floating"], economic:["Used in water quality studies","Indicator species"], location:["Freshwater ponds","Clean, slow-moving waters"]},
"scenedesmus": {images:["images/scenedesmus1.jpg","images/scenedesmus2.jpg"], habit:["Colonial green algae","Forms four-cell colonies","Common planktonic algae"], economic:["Used in biofuel research","Indicator of water quality"], location:["Freshwater ponds","Often in nutrient-rich waters"]}
};

// Load model
async function loadModel(){
    model = await tf.loadLayersModel("my_model/model.json");
    const metadata = await fetch("my_model/metadata.json").then(res=>res.json());
    classes = metadata.labels.map(l => l.trim().toLowerCase());
    console.log("Model loaded with classes:", classes);
}
loadModel();

// Star rating
const starsContainer = document.getElementById("stars");
const thankMessage = document.getElementById("thankMessage");
let rating = 0;
function renderStars(){
    starsContainer.innerHTML="";
    for(let i=1;i<=5;i++){
        const star = document.createElement("span");
        star.innerHTML = i<=rating?"‚òÖ":"‚òÜ";
        star.onclick = ()=>{ rating=i; renderStars(); showThanks(i); };
        starsContainer.appendChild(star);
    }
}
function showThanks(stars){
    const messages = {1:"üò¢ We'll improve! Thanks!",2:"üôÇ Thank you! We‚Äôll grow!",3:"üòä Nice! Thanks!",4:"üåü Awesome! You‚Äôre amazing!",5:"üòç WOW! You love our pond!"};
    thankMessage.innerText = messages[stars];
}
renderStars();

// Carousel
function createCarousel(images){
    const carouselDiv=document.getElementById("carousel");
    carouselDiv.innerHTML="";
    if(images.length===0) return;
    images.forEach((src,i)=>{
        const img=document.createElement("img");
        img.src=src;
        if(i===0) img.classList.add("active");
        carouselDiv.appendChild(img);
    });
    const prevBtn=document.createElement("button");
    prevBtn.className="prev"; prevBtn.innerHTML="&#10094;"; prevBtn.onclick=()=>{ moveSlide(-1); };
    const nextBtn=document.createElement("button");
    nextBtn.className="next"; nextBtn.innerHTML="&#10095;"; nextBtn.onclick=()=>{ moveSlide(1); };
    carouselDiv.appendChild(prevBtn); carouselDiv.appendChild(nextBtn);
    carouselDiv.currentIndex=0;
}
function moveSlide(dir){
    const carouselDiv=document.getElementById("carousel");
    const imgs=carouselDiv.querySelectorAll("img");
    imgs[carouselDiv.currentIndex].classList.remove("active");
    carouselDiv.currentIndex=(carouselDiv.currentIndex+dir+imgs.length)%imgs.length;
    imgs[carouselDiv.currentIndex].classList.add("active");
}

// Image upload & prediction
document.getElementById("imageUpload").addEventListener("change", async function(event){
    const file=event.target.files[0];
    const img=new Image();
    img.src=URL.createObjectURL(file);
    img.onload=async function(){
        const tensor=tf.browser.fromPixels(img).resizeNearestNeighbor([224,224]).toFloat().div(255.0).expandDims();
        const prediction=model.predict(tensor);
        const data=await prediction.data();
        const maxValue=Math.max(...data);
        const index=data.indexOf(maxValue);
        const predictedClass=classes[index]; // already lowercase
        const confidence=(maxValue*100).toFixed(2);
        const predictionText=document.getElementById("prediction");
        const descriptionBox=document.getElementById("description");

        const info=algaeInfo[predictedClass] || algaeInfo[predictedClass.toLowerCase()];
        if(maxValue>=CONFIDENCE_THRESHOLD && info){
            predictionText.innerHTML="Prediction: <b>"+predictedClass.charAt(0).toUpperCase() + predictedClass.slice(1)+"</b><br>Confidence: "+confidence+"%";
            createCarousel(info.images);
            descriptionBox.innerHTML=
                "<h3>Habit</h3><ul>"+info.habit.map(x=>"<li>"+x+"</li>").join("")+"</ul>"+
                "<h3>Economic Importance</h3><ul>"+info.economic.map(x=>"<li>"+x+"</li>").join("")+"</ul>"+
                "<h3>Location</h3><ul>"+info.location.map(x=>"<li>"+x+"</li>").join("")+"</ul>";
        }else{
            predictionText.innerHTML="Confidence: "+confidence+"%";
            createCarousel([]);
            descriptionBox.innerHTML="<h3>üêüüåø Oops!</h3><p>Hmm‚Ä¶ this algae is not yet in our pond! If you know it, please contribute üå±üíö</p>";
        }
    };
});

// Buttons
document.querySelector(".contribute").addEventListener("click",()=>{ alert("üåø Thank you for helping our algae ecosystem grow!"); });
document.querySelector(".explore").addEventListener("click",()=>{ alert("üåé Global algae exploration coming soon!"); });
</script>

</body>
</html>
