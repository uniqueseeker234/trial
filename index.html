<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Welcome to Our Algae Pond</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap" rel="stylesheet">


<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>

<style>
html, body {
  margin:0;
  height:100%;
 font-family: 'Poppins', sans-serif;
  overflow-x:hidden;
}

/* 3 clean layers */
body {
  background: linear-gradient(to bottom, #3b9d4c 0%, #3b9d4c 33%, #f5e0a1 33%, #f5e0a1 66%, #1c3e8a 66%, #1c3e8a 100%);
  position: relative;
}
  /* Pond animation layer (behind UI) */
#pond-layer{
  position: fixed;
  inset: 0;
  z-index: 0;
  pointer-events: none;
}

/* Heading */
/* Heading with sway, works for desktop and mobile */
h1{
  padding: 30px 10px;
  font-family: 'Fredoka One', cursive;
  color: #ffffff;
  font-size: 48px;
  letter-spacing: 2px;
  margin: 0;

  width: 100%;
  text-align: center;

  position: relative;
  left: 0;
  transform: rotate(0deg);
  animation: swayTitle 3s ease-in-out infinite;
}

@keyframes swayTitle{
  0%   { transform: rotate(-2deg); }
  50%  { transform: rotate(2deg); }
  100% { transform: rotate(-2deg); }
}


/* Layout */
.container { 
  display:flex; 
  justify-content:center; 
  gap:40px; 
  padding:20px; 
  flex-wrap:wrap; 
  position: relative;
  z-index: 5;
}

 .card {
  background:white;
  padding:25px;
  border-radius:15px;
  box-shadow:0 10px 25px rgba(0,0,0,0.2);
  animation:fadeIn 1s ease;
  position: relative;
  z-index: 5;
}


/* Upload box */
.upload-box {
  background:#f1f1f1;
  padding:25px;
  border-radius:12px;
  text-align:center;
  cursor:pointer;
  transition:0.3s;
}
.upload-box:hover { background:#e0fff0; transform:scale(1.03); }

/* Carousel */
.carousel { margin-top:15px; position:relative; width:100%; max-width:180px; }
.carousel img { width:100%; border-radius:10px; display:none; }
.carousel img.active { display:block; }
.carousel button { position:absolute; top:50%; transform:translateY(-50%); background:rgba(0,0,0,0.3); border:none; color:white; font-size:20px; padding:5px 10px; cursor:pointer; border-radius:5px; }
.prev { left:5px; } .next { right:5px; }

/* Description */
.description { margin-top:20px; font-size:14px; line-height:1.5; }

/* Stars */
.stars span {
  font-size:30px;
  cursor:pointer;
  color:gray; /* empty color */
  display:inline-block;
  transition: transform 0.3s, color 0.3s;
}
.stars span.filled { color: gold; animation: bounce 0.5s ease forwards; }

@keyframes bounce {
  0% { transform: scale(1.2); }
  50% { transform: scale(1.5); }
  100% { transform: scale(1.2); }
}

/* Buttons */
button { padding:10px 18px; margin:8px; border-radius:8px; border:none; cursor:pointer; font-size:14px; transition:0.3s; }
button:hover { transform:scale(1.05); }
.contribute { background:#27ae60; color:white; }
.explore { background:#2980b9; color:white; }

/* Thank message */
.thank-message { margin-top:10px; font-size:14px; min-height:24px; transition:0.3s; }

/* Bubbles */
.bubble {
  position: fixed;
  bottom: -50px;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9), rgba(173,216,230,0.4));
  box-shadow: 0 0 15px rgba(255,255,255,0.8);
  animation: rise linear infinite;
  pointer-events: auto;
  z-index: 10;
  transition: transform 0.3s ease, opacity 0.3s ease;
}

.bubble:active {
  transform: scale(2) !important;
  opacity:0 !important;
}

@keyframes rise { 0% { transform: translateY(0); opacity:0.6; } 100% { transform: translateY(-110vh); opacity:0; } }

/* Responsive */
@media (max-width:900px){ 
  .container{
    flex-direction:column; 
    align-items:center;
  }

  h1{
    font-size: 35px;   /* balanced size */
    letter-spacing: 1.5px;
    padding: 24px 10px;
  }
}


 /* Cartoon Pond Creatures */

/* Fish base */
.fish {
  position: fixed;
  width: 40px;
  height: 20px;
  border-radius: 50%;
  animation: none !important;
}

/* RIGHT fish (swims right, head on right, tail on left) */
.fish.right::before {
  content:"";
  position:absolute;
  right:6px;
  top:6px;
  width:5px;
  height:5px;
  background:white;
  border-radius:50%;
}
.fish.right::after {
  content:"";
  position:absolute;
  left:-10px;
  top:5px;
  width:10px;
  height:10px;
  background:inherit;
  clip-path: polygon(0 50%, 100% 0, 100% 100%);
}

/* LEFT fish (swims left, head on left, tail on right) */
.fish.left::before {
  content:"";
  position:absolute;
  left:6px;
  top:6px;
  width:5px;
  height:5px;
  background:white;
  border-radius:50%;
}
.fish.left::after {
  content:"";
  position:absolute;
  right:-10px;
  top:5px;
  width:10px;
  height:10px;
  background:inherit;
  clip-path: polygon(100% 50%, 0 0, 0 100%);
}


/* Frog: green oval with eyes */
.frog {
  position: absolute;
  width: 30px;
  height: 20px;
  background: limegreen;
  border-radius: 50%;
  animation: jump 2s ease-in-out infinite;
   z-index: 6;  /* frog always on top */
}
.frog::before, .frog::after {
  content: "";
  position: absolute;
  top: -5px;
  width: 6px;
  height: 6px;
  background: white;
  border-radius: 50%;
}
.frog::before { left: 4px; }   /* left eye */
.frog::after { right: 4px; }  /* right eye */

/* Frog jump animation */
@keyframes jump {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-25px); }
}
  /* Ripple under frog */
.ripple {
  position: absolute;
  width: 36px;
  height: 16px;
  border: 2px solid rgba(255,255,255,0.45);
  border-radius: 50%;
  bottom: 16%;
  animation: ripple 1.6s ease-out infinite;
  pointer-events: none;
  z-index: 0;
}

@keyframes ripple {
  0%   { transform: scale(0.7); opacity: 0.55; }
  100% { transform: scale(1.7); opacity: 0; }
}

  /* Seaweed with faster sway (small range) */
.seaweed {
  position: absolute;
  width: 12px;
  height: 100px;
  background: #2e7d32;
  bottom: 0;
  border-radius: 20px 20px 10px 10px;
  animation: swayweed 1.5s ease-in-out infinite alternate; /* faster */
}

@keyframes swayweed {
  0% { transform: rotate(-5deg); }
  100% { transform: rotate(5deg); }
}

.bubble-trail{
  position: fixed;              /* fixed = uses viewport coords (matches getBoundingClientRect) */
  width: 6px;
  height: 6px;
  border-radius: 50%;
  pointer-events: none;

  /* visible over white cards */
  background: rgba(255,255,255,0.95);
  filter: blur(0.2px);

  /* sits over UI, but under fish */
  z-index: 11;

  animation: bubbleTrail 0.65s ease-out forwards;
}

@keyframes bubbleTrail{
  from { transform: translateY(0) scale(1); opacity: 0.9; }
  to   { transform: translateY(-18px) scale(0.7); opacity: 0; }
}



  /* Lotus pad */
.lotus {
  position: absolute;
  width: 60px;
  height: 30px;
  background: #2e8b57;       /* green color */
  border-radius: 50%;        /* oval shape */
  bottom: 15%;               /* vertical position on pond */
  z-index: 1;                /* appear above water/seaweed */
  animation: sway 4s ease-in-out infinite alternate; /* gentle sway */
}

/* Lotus sway animation */
@keyframes sway {
  0%   { transform: translateX(0); }
  50%  { transform: translateX(8px); }
  100% { transform: translateX(0); }
}
/* IMPORTANT: disable any old fish animation that changes transform */
.fish{
  animation: none !important;      /* kills swim keyframes that rotate/flip */
  will-change: left;
}
.lotus-flower{
  position:absolute;

  left: 1%;     /* slightly left side of pad */
  top: 50%;      /* vertical center */

  width:30px;
  height:30px;
  z-index:3;
  pointer-events:none;

  transform: translateY(-60%);  /* vertically center on pad */
  animation: flowerSway 3.2s ease-in-out infinite;
}
@keyframes flowerSway{
  0%   { transform: translateY(-60%) rotate(-2deg); }
  50%  { transform: translateY(-62%) rotate(2deg); }
  100% { transform: translateY(-60%) rotate(-2deg); }
}


.lotus-flower span{
  position:absolute;
  width:12px;
  height:16px;
  background: rgba(255,182,193,0.95);
  border-radius: 50%;
  top:8px;
  left:9px;
  transform-origin: center bottom;
  animation: petalPulse 2.4s ease-in-out infinite;
}

@keyframes petalPulse{
  0%,100% { filter: brightness(1); }
  50%     { filter: brightness(1.08); }
}

/* 6 petals */
.lotus-flower span:nth-child(1){ transform: rotate(0deg)   translateY(-7px); }
.lotus-flower span:nth-child(2){ transform: rotate(60deg)  translateY(-7px); }
.lotus-flower span:nth-child(3){ transform: rotate(120deg) translateY(-7px); }
.lotus-flower span:nth-child(4){ transform: rotate(180deg) translateY(-7px); }
.lotus-flower span:nth-child(5){ transform: rotate(240deg) translateY(-7px); }
.lotus-flower span:nth-child(6){ transform: rotate(300deg) translateY(-7px); }

.lotus-flower::after{
  content:"";
  position:absolute;
  width:10px;
  height:10px;
  background: rgba(255,215,0,0.95);
  border-radius:50%;
  top:10px;
  left:10px;
}

  
/* Touch ripple on water */
.touch-ripple{
  position: fixed;
  width: 18px;
  height: 18px;
  border: 2px solid rgba(255,255,255,0.55);
  border-radius: 50%;
  pointer-events: none;
  z-index: 2;
  transform: translate(-50%, -50%) scale(0.6);
  opacity: 0.8;
  animation: touchRipple 0.8s ease-out forwards;
}

@keyframes touchRipple{
  to{
    transform: translate(-50%, -50%) scale(2.4);
    opacity: 0;
  }
}

</style>
</head>
<body>
<div id="pond-layer"></div>
<h1>Welcome to Our Algae Pond üåø</h1>

<div class="container">

<!-- LEFT -->
<div class="card">
  <div class="upload-box" onclick="document.getElementById('imageUpload').click()">üåø Select your algae photo to start!</div>
  <input type="file" id="imageUpload" accept="image/*" style="display:none;">
  <h2 id="prediction"></h2>
  <div class="carousel" id="carousel"></div>
  <div id="description" class="description"></div>
</div>

<!-- RIGHT -->
<div class="card" style="text-align:center; min-width:250px;">
  <div class="stars" id="stars"></div>
  <div class="thank-message" id="thankMessage"></div>
  <button class="contribute">Contribute üì®</button>
  <button class="explore">Explore Algae Around the World üåè</button>
</div>
</div>

<script>
// Model setup
let model;
let classes = [];
const CONFIDENCE_THRESHOLD = 0.65;
  const pond = document.getElementById("pond-layer");

// Algae info (images & description)
const algaeInfo = {
"spirogyra": {images:["images/spirogyra1.jpg","images/spirogyra2.jpg"], habit:["Filamentous freshwater green algae","Forms floating slimy masses","Has spiral chloroplasts"], economic:["Produces oxygen in ponds","Used in biological research"], location:["Found in freshwater ponds","Common in slow-moving water bodies"]},
"cladophora": {images:["images/cladophora1.jpg","images/cladophora2.jpg","images/cladophora3.jpg"], habit:["Branched filamentous green algae","Attaches to submerged surfaces","Forms dense green mats"], economic:["Provides shelter for aquatic organisms","Indicates nutrient pollution levels"], location:["Freshwater & marine habitats","Common in nutrient-rich environments"]},
"oedogonium": {images:["images/oedogonium1.jpg","images/oedogonium2.jpg"], habit:["Filamentous green algae with basal holdfast","Grows in mats or attached filaments","Prefers calm water"], economic:["Used in research and water quality monitoring","Oxygen producer in water bodies"], location:["Freshwater ponds and slow streams","Common in nutrient-rich ponds"]},
"volvox": {images:["images/volvox1.jpg","images/volvox2.jpg"], habit:["Spherical colonial green algae","Colonies with flagella","Forms motile spheres"], economic:["Used in biological experiments","Oxygen producer"], location:["Freshwater ponds and lakes","Common in nutrient-rich water"]},
"nostoc": {images:["images/nostoc1.jpg","images/nostoc2.jpg"], habit:["Cyanobacteria forming colonies","Gelatinous colonies","Filamentous structure"], economic:["Nitrogen fixation","Used in research"], location:["Freshwater and moist soils","Found on rocks and soil surfaces"]},
"pediastrum": {images:["images/pediastrum1.jpg","images/pediastrum2.jpg"], habit:["Colonial green algae","Flat star-like colonies","Planktonic in water"], economic:["Used in ecological studies","Indicator of water quality"], location:["Freshwater ponds","Common in nutrient-rich water"]},
"cosmarium": {images:["images/cosmarium1.jpg","images/cosmarium2.jpg"], habit:["Single-celled green algae with semicells","Desmids are symmetrical","Often found in colonies"], economic:["Used in ecological studies","Indicator of water quality"], location:["Freshwater habitats","Ponds and lakes with clean water"]},
"noctiluca": {images:["images/noctiluca1.jpg","images/noctiluca2.jpg"], habit:["Bioluminescent marine plankton","Single-celled","Motile with flagella"], economic:["Indicators of marine water health","Can cause red tides"], location:["Marine environments","Coastal waters worldwide"]},
"staurastrum": {images:["images/staurastrum1.jpg","images/staurastrum2.jpg"], habit:["Single-celled desmid","Star-shaped cells","Free-floating"], economic:["Used in water quality studies","Indicator species"], location:["Freshwater ponds","Clean, slow-moving waters"]},
"scenedesmus": {images:["images/scenedesmus1.jpg","images/scenedesmus2.jpg"], habit:["Colonial green algae","Forms four-cell colonies","Common planktonic algae"], economic:["Used in biofuel research","Indicator of water quality"], location:["Freshwater ponds","Often in nutrient-rich waters"]}
};

// Load model
async function loadModel(){
    model = await tf.loadLayersModel("my_model/model.json");
    const metadata = await fetch("my_model/metadata.json").then(res=>res.json());
    classes = metadata.labels.map(l => l.trim().toLowerCase());
}
loadModel();

// Stars
const starsContainer = document.getElementById("stars");
const thankMessage = document.getElementById("thankMessage");
let rating = 0;
function renderStars(){
    starsContainer.innerHTML="";
    for(let i=1;i<=5;i++){
        const star = document.createElement("span");
        star.innerHTML="‚òÜ"; // empty star
        star.onclick=()=> rateStar(i);
        star.addEventListener("touchstart",()=> rateStar(i));
        if(i<=rating){ star.innerHTML="‚òÖ"; star.classList.add("filled"); }
        starsContainer.appendChild(star);
    }
}
 const MAX_BUBBLES = 22;

function spawnOneBubble(){
  const b = document.createElement("div");
  b.className = "bubble";
  b.style.background = ["white","#4caf50","#4fc3f7"][Math.floor(Math.random()*3)];
  b.style.left = Math.random()*window.innerWidth + "px";

  const size = 15 + Math.random()*15;
  b.style.width = size + "px";
  b.style.height = size + "px";

  const duration = 6 + Math.random()*6;
  b.style.animationDuration = duration + "s";

  let isDragging=false, offsetX=0, offsetY=0;

  b.addEventListener("mousedown", (e)=>{
    isDragging=true;
    offsetX=e.clientX - b.offsetLeft;
    offsetY=e.clientY - b.offsetTop;
    b.style.transition="none";
  });

  document.addEventListener("mousemove", (e)=>{
    if(isDragging){
      b.style.left = (e.clientX - offsetX) + "px";
      b.style.top  = (e.clientY - offsetY) + "px";
    }
  });

  document.addEventListener("mouseup", ()=>{
    if(isDragging){
      isDragging=false;
      b.style.transition="";
    }
  });

 // Touch: drag OR tap-to-pop (tap = no movement)
let startX = 0, startY = 0, moved = false;

b.addEventListener("touchstart", (e)=>{
  isDragging = true;
  moved = false;

  const t = e.touches[0];
  startX = t.clientX;
  startY = t.clientY;

  offsetX = t.clientX - b.offsetLeft;
  offsetY = t.clientY - b.offsetTop;

  b.style.transition = "none";
}, {passive:true});

document.addEventListener("touchmove", (e)=>{
  if(!isDragging) return;

  const t = e.touches[0];
  const dx = Math.abs(t.clientX - startX);
  const dy = Math.abs(t.clientY - startY);

  if(dx > 6 || dy > 6) moved = true; // threshold to detect drag

  b.style.left = (t.clientX - offsetX) + "px";
  b.style.top  = (t.clientY - offsetY) + "px";
}, {passive:true});

document.addEventListener("touchend", ()=>{
  if(!isDragging) return;
  isDragging = false;
  b.style.transition = "";

  // If it was a tap (not dragged), pop it
  if(!moved) b.remove();
});

  // Pop on click (desktop) and on double-tap (mobile feel)
  b.addEventListener("click", ()=> b.remove());

  // Remove automatically when animation completes (no "auto pop at bottom")
  b.addEventListener("animationend", ()=> b.remove());

  document.body.appendChild(b);
}

function createBubbles(){
  // initial batch
  for(let i=0;i<MAX_BUBBLES;i++) spawnOneBubble();

  // refill forever
  setInterval(()=>{
    const current = document.querySelectorAll(".bubble").length;
    const needed = MAX_BUBBLES - current;
    for(let i=0;i<needed;i++) spawnOneBubble();
  }, 1000);
}

createBubbles();
function createCreatures() {

  // ---------- FISH (4 fish, fixed layers, bubble trail over cards) ----------
 const fishConfigs = [
  { color: "purple", top: "10%", dir: "right" },
  { color: "blue",   top: "18%", dir: "right" },
  { color: "orange", top: "36%", dir: "left"  },
  { color: "green",  top: "48%", dir: "left"  },
  { color: "red",    top: "68%", dir: "right" } // lifted above frog zone
];

  fishConfigs.forEach((cfg, i) => {
    const fish = document.createElement("div");
    fish.className = "fish " + cfg.dir;
    fish.style.background = cfg.color;
    fish.style.top = cfg.top;

    // optional fin
    fish.style.color = cfg.color;
    const fin = document.createElement("div");
    fin.className = "fin";
    fish.appendChild(fin);

    // fish above cards
    fish.style.zIndex = "12";
    document.body.appendChild(fish);

    // swim animation
    const duration = 11000 + i * 1200;
    const randomDelay = -Math.random() * duration;

    if (cfg.dir === "right") {
      fish.style.left = "-80px";
      fish.animate(
        [{ left: "-80px" }, { left: "calc(100vw + 80px)" }],
        { duration, iterations: Infinity, easing: "linear", delay: randomDelay }
      );
    } else {
      fish.style.left = "calc(100vw + 80px)";
      fish.animate(
        [{ left: "calc(100vw + 80px)" }, { left: "-80px" }],
        { duration, iterations: Infinity, easing: "linear", delay: randomDelay }
      );
    }

    // ‚úÖ bubble trail (MUST be inside setInterval)
    setInterval(() => {
      const r = fish.getBoundingClientRect();
      const b = document.createElement("div");
      b.className = "bubble-trail";

      const s = 4 + Math.random() * 3;
      b.style.width = s + "px";
      b.style.height = s + "px";

      // glow visible on white cards
      b.style.boxShadow = "0 0 10px " + cfg.color + ", 0 0 18px " + cfg.color;

      const x = (cfg.dir === "right") ? (r.left - 10) : (r.right + 10);
      b.style.left = x + "px";
      b.style.top  = (r.top + r.height * 0.65) + "px";

      document.body.appendChild(b);
      setTimeout(() => b.remove(), 700);
    }, 180);
  });


  // ---------- LOTUS PADS + FLOWERS (behind cards) ----------
  function makeLotus(leftPos){
    const lotus = document.createElement("div");
    lotus.className = "lotus";
    lotus.style.left = leftPos;

    const flower = document.createElement("div");
    flower.className = "lotus-flower";
    for(let i=0;i<6;i++){
      flower.appendChild(document.createElement("span"));
    }

    lotus.appendChild(flower);
    pond.appendChild(lotus);
  }

  makeLotus("20%");
  makeLotus("70%");


  // ---------- FROGS (behind cards) ----------
  const frog1 = document.createElement("div");
  frog1.className = "frog";
  frog1.style.left = "25%";
  frog1.style.bottom = "18%";
  pond.appendChild(frog1);

  const ripple1 = document.createElement("div");
  ripple1.className = "ripple";
  ripple1.style.left = "25%";
  pond.appendChild(ripple1);

  const frog2 = document.createElement("div");
  frog2.className = "frog";
  frog2.style.left = "75%";
  frog2.style.bottom = "18%";
  pond.appendChild(frog2);

  const ripple2 = document.createElement("div");
  ripple2.className = "ripple";
  ripple2.style.left = "75%";
  ripple2.style.animationDelay = "0.6s";
  pond.appendChild(ripple2);


  // ---------- SEAWEED (behind cards) ----------
  for (let i = 0; i < 9; i++) {
    const seaweed = document.createElement("div");
    seaweed.className = "seaweed";
    seaweed.style.left = 5 + i * 10 + Math.random() * 5 + "%";
    seaweed.style.height = 80 + Math.random() * 30 + "px";
    pond.appendChild(seaweed);
  }
}

// call once
createCreatures();


function isInBlueZone(clientY){
  const h = window.innerHeight;
  return clientY >= h * 0.66; // blue starts at 66%
}

function makeRipple(x, y){
  const r = document.createElement("div");
  r.className = "touch-ripple";
  r.style.left = x + "px";
  r.style.top = y + "px";
  document.body.appendChild(r);
  setTimeout(()=> r.remove(), 900);
}

// Touch + click support
document.addEventListener("pointerdown", (e) => {
  if(!isInBlueZone(e.clientY)) return;      // only in blue
  // avoid creating ripples when tapping UI cards/buttons
  if (e.target.closest(".card, button, input, .upload-box, .carousel")) return;

  makeRipple(e.clientX, e.clientY);

  // optional: 2 extra small ripples for a nicer splash
  setTimeout(()=> makeRipple(e.clientX + 12, e.clientY + 4), 90);
  setTimeout(()=> makeRipple(e.clientX - 10, e.clientY + 6), 160);
});

function rateStar(i){
    rating=i;
    renderStars();
    const messages={1:"üò¢ We'll improve! Thanks!",2:"üôÇ Thank you! We‚Äôll grow!",3:"üòä Nice! Thanks!",4:"üåü Awesome! You‚Äôre amazing!",5:"üòç WOW! You love our pond!"};
    thankMessage.innerText=messages[i];
}
renderStars();

// Carousel
function createCarousel(images){
    const carouselDiv=document.getElementById("carousel");
    carouselDiv.innerHTML="";
    if(images.length===0) return;
    images.forEach((src,i)=>{
        const img=document.createElement("img");
        img.src=src;
        if(i===0) img.classList.add("active");
        carouselDiv.appendChild(img);
    });
    const prevBtn=document.createElement("button");
    prevBtn.className="prev"; prevBtn.innerHTML="&#10094;"; prevBtn.onclick=()=>{ moveSlide(-1); };
    const nextBtn=document.createElement("button");
    nextBtn.className="next"; nextBtn.innerHTML="&#10095;"; nextBtn.onclick=()=>{ moveSlide(1); };
    carouselDiv.appendChild(prevBtn);
    carouselDiv.appendChild(nextBtn);
    carouselDiv.currentIndex=0;
}
function moveSlide(dir){
    const carouselDiv=document.getElementById("carousel");
    const imgs=carouselDiv.querySelectorAll("img");
    imgs[carouselDiv.currentIndex].classList.remove("active");
    carouselDiv.currentIndex=(carouselDiv.currentIndex+dir+imgs.length)%imgs.length;
    imgs[carouselDiv.currentIndex].classList.add("active");
}

// Prediction
document.getElementById("imageUpload").addEventListener("change", async function(event){
    const file=event.target.files[0];
    const img=new Image();
    img.src=URL.createObjectURL(file);
    img.onload=async function(){
        const tensor=tf.browser.fromPixels(img).resizeNearestNeighbor([224,224]).toFloat().div(255.0).expandDims();
        const prediction=model.predict(tensor);
        const data=await prediction.data();
        const maxValue=Math.max(...data);
        const index=data.indexOf(maxValue);
        const predictedClass=classes[index]; 
        const confidence=(maxValue*100).toFixed(2);
        const predictionText=document.getElementById("prediction");
        const descriptionBox=document.getElementById("description");
        const info=algaeInfo[predictedClass] || algaeInfo[predictedClass.toLowerCase()];
      // Check if predicted class is "unknown algae"
if(predictedClass.toLowerCase() === "unknown algae") {
    predictionText.innerHTML = "Prediction: Unknown Algae";
    descriptionBox.innerHTML = "<h3>üêüüåø Hmm‚Ä¶ this algae is not yet in our pond!</h3><p>If you know it, please contribute a photo üå±üíö</p>";
    createCarousel([]); // clear any images
    return; // skip the normal prediction block
}

        if(maxValue>=CONFIDENCE_THRESHOLD && info){
            predictionText.innerHTML="Prediction: <b>"+predictedClass.charAt(0).toUpperCase()+predictedClass.slice(1)+"</b><br>Confidence: "+confidence+"%";
            createCarousel(info.images);
            descriptionBox.innerHTML=
                "<h3>Habit</h3><ul>"+info.habit.map(x=>"<li>"+x+"</li>").join("")+"</ul>"+
                "<h3>Economic Importance</h3><ul>"+info.economic.map(x=>"<li>"+x+"</li>").join("")+"</ul>"+
                "<h3>Location</h3><ul>"+info.location.map(x=>"<li>"+x+"</li>").join("")+"</ul>";
        }else{
            predictionText.innerHTML="Confidence: "+confidence+"%";
            createCarousel([]);
            descriptionBox.innerHTML="<h3>üêüüåø Oops!</h3><p>Hmm‚Ä¶ this algae is not yet in our pond! If you know it, please contribute üå±üíö</p>";
        }
    };
});

// Buttons
document.querySelector(".contribute").addEventListener("click",()=>{
    const email="uniqueseeekers123@gmail.com";
    const subject=encodeURIComponent("Algae Contribution üåø");
    const body=encodeURIComponent("Hello! I want to contribute an algae image or info to your pond project.");
    if(window.innerWidth>768){ // desktop
        alert(`üíö Thanks for contributing to our pond!\nSend images/info to: ${email}`);
    } else { // mobile
        alert(`üíö Thanks for contributing to our pond! We'll open your mail client now!`);
        window.location.href=`mailto:${email}?subject=${subject}&body=${body}`;
    }
});
document.querySelector(".explore").addEventListener("click",()=>{ alert("üåé Global algae exploration coming soon!"); });
</script>

</body>
</html>




















































