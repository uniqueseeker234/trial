<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Algae Pond ğŸŒ¿</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body {
    margin:0;
    font-family: sans-serif;
    background: linear-gradient(to bottom, #a0e9fd, #75c6a0);
    overflow-x: hidden;
    position: relative;
  }

  /* Ripple / wave background */
  body::before {
    content:'';
    position:absolute;
    top:0; left:0;
    width:100%; height:100%;
    background: url('https://www.transparenttextures.com/patterns/waves.png') repeat;
    opacity:0.2;
    animation: wave 20s linear infinite;
    z-index:0;
  }
  @keyframes wave { 
    0% { background-position:0 0; } 
    100% { background-position:1000px 0; } 
  }

  /* Fish emojis */
  .fish {
    position: absolute;
    font-size: 2rem;
    animation: swim linear infinite;
    z-index:1;
  }
  @keyframes swim {
    0% { left:-50px; transform: scaleX(1); }
    50% { left:50%; transform: scaleX(-1); }
    100% { left:110%; transform: scaleX(1); }
  }

  /* Reef / seaweed emojis */
  .reef {
    position: absolute;
    bottom:0;
    font-size: 2.5rem;
    animation: sway ease-in-out infinite alternate;
    transform-origin: bottom center;
    z-index:1;
  }
  @keyframes sway {
    0% { transform: rotate(-10deg); }
    100% { transform: rotate(10deg); }
  }

  /* Bubbles */
  .bubble {
    position: absolute;
    bottom: 0;
    width: 10px; height: 10px;
    background: rgba(255,255,255,0.5);
    border-radius: 50%;
    animation: rise linear infinite;
    z-index:1;
  }
  @keyframes rise {
    0% { transform: translateY(0) translateX(0); }
    100% { transform: translateY(-400px) translateX(30px); }
  }

  /* Cards */
  .card {
    border-radius: 15px;
    box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    margin-bottom: 20px;
    transition: transform 0.3s, opacity 0.5s;
    opacity: 0;
    position:relative;
    z-index:2;
  }
  .card.show { opacity:1; }
  .card:hover { transform: translateY(-5px); }
</style>
</head>
<body>

<!-- Fish emojis -->
<div class="fish" style="top:5%;">ğŸŸ</div>
<div class="fish" style="top:15%; animation-duration:12s;">ğŸŸ</div>
<div class="fish" style="top:25%; animation-duration:16s;">ğŸŸ</div>
<div class="fish" style="top:35%; animation-duration:14s;">ğŸ </div>
<div class="fish" style="top:45%; animation-duration:18s;">ğŸ¡</div>
<div class="fish" style="top:55%; animation-duration:13s;">ğŸŸ</div>
<div class="fish" style="top:65%; animation-duration:17s;">ğŸŸ</div>
<div class="fish" style="top:75%; animation-duration:15s;">ğŸŸ</div>
<div class="fish" style="top:85%; animation-duration:19s;">ğŸ </div>

<!-- Reef / seaweed emojis -->
<div class="reef" style="left:5%; font-size:3rem;">ğŸª¸</div>
<div class="reef" style="left:15%; font-size:2.8rem; animation-duration:3.5s;">ğŸŒ¿</div>
<div class="reef" style="left:25%; font-size:3.2rem; animation-duration:4s;">ğŸŒ±</div>
<div class="reef" style="left:35%; font-size:3rem; animation-duration:3.8s;">ğŸª¸</div>
<div class="reef" style="left:45%; font-size:2.9rem; animation-duration:4.2s;">ğŸ€</div>
<div class="reef" style="left:55%; font-size:3rem; animation-duration:3.9s;">Â°</div>
<div class="reef" style="left:65%; font-size:2.7rem; animation-duration:4.5s;">â€¢:Â°</div>
<div class="reef" style="left:75%; font-size:3rem; animation-duration:3.6s;">ğŸª¸</div>

<!-- Bubbles container -->
<div id="bubbles"></div>

<!-- UI container -->
<div class="container mt-5 text-center" style="position:relative; z-index:2;">
  <h1 class="mb-4">Algae Pond Identifier ğŸŒ¿</h1>

  <!-- Upload Card -->
  <div class="card p-4 show">
    <input type="file" class="form-control" id="imageUpload" accept="image/*">
    <div id="message" class="text-success mt-2">
      <span id="scanText">Upload your algae photo to start!</span>
      <span id="spinner" class="d-none">ğŸŒ€</span>
    </div>
  </div>

  <!-- Prediction Card -->
  <div id="result" class="card p-3 d-none">
    <h3 id="predictedName"></h3>
    <p id="confidence"></p>
    <p id="description"></p>
  </div>

  <!-- Contribute -->
  <button class="btn btn-success mb-2" onclick="contribute()">
    Contribute ğŸ“¨
  </button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
<script>
const MODEL_URL = "my_model/";
let model, maxPredictions;

// Example algae info
const algaeInfo = {
  "Cladophora": { description: "Filamentous green algae forming dense mats. Found in freshwater ponds. Economic importance: wastewater treatment." },
  "Oedogonium": { description: "Filamentous green algae. Attaches to stones and plants. Produces oxygen in water. Economic importance: fish feed." },
  "Spirogyra": { description: "Green algae with spiral chloroplasts. Forms floating mats. Economic importance: lab study and oxygen production." },
  "Cosmarium": { description: "Symmetrical green desmid. Bioindicator for ecology. Economic importance: pigment source." }
};

// Load model
async function init() {
  model = await tmImage.load(MODEL_URL + "model.json", MODEL_URL + "metadata.json");
  maxPredictions = model.getTotalClasses();
  console.log("Model loaded!");
}
init();

// Mobile detection
function isMobileDevice() { return /Mobi|Android|iPhone|iPad/i.test(navigator.userAgent); }

// Contribute button
function contribute() {
  if(isMobileDevice()){
    window.location.href = 'mailto:uniqueseekers123@gmail.com?subject=Algae Contribution';
  } else {
    alert("Please email your algae photos to: uniqueseekers123@gmail.com");
  }
}

// Image upload & prediction
document.getElementById("imageUpload").addEventListener("change", async function(){
  const file = this.files[0]; if(!file) return;
  const confidenceThreshold = 0.6; // 60%
  document.getElementById("spinner").classList.remove("d-none");
  const img = new Image(); img.src = URL.createObjectURL(file);
  img.onload = async ()=>{
    try{
      const prediction = await model.predict(img);
      const topPred = prediction.reduce((a,b)=>a.probability>b.probability?a:b);
      let algaeKey = null;
      if(topPred.probability >= confidenceThreshold){
        algaeKey = Object.keys(algaeInfo).find(k=>topPred.className.toLowerCase().includes(k.toLowerCase()));
      }
      document.getElementById("spinner").classList.add("d-none");
      const resultCard = document.getElementById("result");
      if(algaeKey){
        document.getElementById("predictedName").innerText = topPred.className;
        document.getElementById("confidence").innerText = "Confidence: "+(topPred.probability*100).toFixed(2)+"%";
        document.getElementById("description").innerText = algaeInfo[algaeKey].description;
      } else {
        document.getElementById("predictedName").innerText = "";
        document.getElementById("confidence").innerText = "Confidence: "+(topPred.probability*100).toFixed(2)+"%";
        document.getElementById("description").innerText = "This algae is not yet recognized in our pond ğŸŒ±. Please contribute photos to help us expand our dataset!";
      }
      resultCard.classList.remove("d-none"); setTimeout(()=>{resultCard.classList.add("show");},50);
      document.getElementById("scanText").innerText = "Prediction complete! ğŸŒ¿";
    } catch(err){
      console.error(err);
      document.getElementById("spinner").classList.add("d-none");
      document.getElementById("scanText").innerText = "Prediction failed.";
    }
  }
});

// Generate bubbles dynamically
function createBubbles(){
  const bubblesContainer = document.getElementById("bubbles");
  for(let i=0;i<20;i++){
    const bubble = document.createElement("div");
    bubble.className="bubble";
    bubble.style.left=Math.random()*window.innerWidth+"px";
    let size=5+Math.random()*15;
    bubble.style.width=size+"px";
    bubble.style.height=size+"px";
    bubble.style.animationDuration=(3+Math.random()*5)+"s";
    bubble.style.opacity=0.4+Math.random()*0.6;
    bubblesContainer.appendChild(bubble);
  }
}
createBubbles();
</script>

</body>
</html>
