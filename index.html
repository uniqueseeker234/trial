<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Algae Pond ğŸŒ¿ğŸŸ</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body {
    margin:0;
    background: linear-gradient(to bottom, #a0e9fd, #75c6a0);
    overflow-x: hidden;
    font-family: sans-serif;
  }

  /* Bubbles */
  .bubble {
    position: absolute;
    bottom: 0;
    width: 10px; height: 10px;
    background: rgba(255,255,255,0.7);
    border-radius: 50%;
    animation: rise linear infinite;
  }
  @keyframes rise {
    0% { transform: translateY(0) translateX(0); }
    100% { transform: translateY(-400px) translateX(30px); }
  }

  /* Fish emoji */
  .fish {
    position: absolute;
    font-size: 2rem;
    animation: swim linear infinite;
  }
  @keyframes swim {
    0% { left:-50px; transform: scaleX(1); }
    50% { left:50%; transform: scaleX(-1); }
    100% { left:110%; transform: scaleX(1); }
  }

  /* Seaweed emoji */
  .seaweed {
    position: absolute;
    bottom:0;
    font-size: 2rem;
    animation: sway ease-in-out infinite alternate;
    transform-origin: bottom center;
  }
  @keyframes sway {
    0% { transform: rotate(-10deg); }
    100% { transform: rotate(10deg); }
  }

  /* Prediction card */
  .card {
    border-radius: 15px;
    box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    margin-bottom: 20px;
    transition: transform 0.3s, opacity 0.5s;
    opacity: 0;
  }
  .card.show { opacity: 1; }
  .card:hover { transform: translateY(-5px); }
</style>
</head>
<body>

<!-- Bubbles -->
<div id="bubbles"></div>

<!-- Fish emojis -->
<div class="fish" style="top:10%;">ğŸŸ</div>
<div class="fish" style="top:30%; animation-duration:14s;">ğŸ </div>
<div class="fish" style="top:50%; animation-duration:18s;">ğŸ¡</div>

<!-- Seaweed emojis -->
<div class="seaweed" style="left:5%;">ğŸŒ¿</div>
<div class="seaweed" style="left:20%; animation-duration:4s;">ğŸŒ±</div>
<div class="seaweed" style="left:35%; animation-duration:3.5s;">ğŸ€</div>
<div class="seaweed" style="left:50%; animation-duration:5s;">ğŸŒ¿</div>
<div class="seaweed" style="left:70%; animation-duration:4.2s;">ğŸŒ±</div>

<!-- UI container -->
<div class="container mt-5 text-center" style="position:relative; z-index:2;">
  <h1 class="mb-4">Algae Pond Identifier ğŸŒ¿ğŸŸ</h1>

  <!-- Upload Card -->
  <div class="card p-4 show">
    <input type="file" class="form-control" id="imageUpload" accept="image/*">
    <div id="message" class="text-success mt-2">
      <span id="scanText">Upload your algae photo to start!</span>
      <span id="spinner" class="d-none">ğŸŒ€</span>
    </div>
  </div>

  <!-- Prediction Card -->
  <div id="result" class="card p-3 d-none">
    <h3 id="predictedName"></h3>
    <p id="confidence"></p>
    <p id="description"></p>
  </div>

  <!-- Contribute -->
  <button class="btn btn-success mb-2" onclick="contribute()">
    Contribute ğŸ“¨
  </button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
<script>
const MODEL_URL = "my_model/";
let model, maxPredictions;

// Example algae info
const algaeInfo = {
  "Cladophora": {
    description: `â€¢ Filamentous green algae forming dense mats.\nâ€¢ Branching filaments.\nâ€¢ Found in freshwater ponds.\nEconomic importance: wastewater treatment.`,
  },
  "Oedogonium": {
    description: `â€¢ Filamentous green algae.\nâ€¢ Attaches to stones and plants.\nâ€¢ Produces oxygen in water.\nEconomic importance: fish feed.`,
  },
  "Spirogyra": {
    description: `â€¢ Green algae with spiral chloroplasts.\nâ€¢ Forms floating mats.\nEconomic importance: lab study and oxygen production.`,
  },
  "Cosmarium": {
    description: `â€¢ Symmetrical green desmid.\nâ€¢ Bioindicator for ecology.\nEconomic importance: pigment source.`,
  }
};

// Load Teachable Machine model
async function init() {
  model = await tmImage.load(MODEL_URL + "model.json", MODEL_URL + "metadata.json");
  maxPredictions = model.getTotalClasses();
  console.log("Model loaded!");
}
init();

// Detect mobile
function isMobileDevice() {
  return /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
}

// Contribute button
function contribute() {
  if(isMobileDevice()){
    window.location.href = 'mailto:uniqueseekers123@gmail.com?subject=Algae Contribution';
  } else {
    alert("Please email your algae photos to: uniqueseekers123@gmail.com");
  }
}

// Handle image upload
document.getElementById("imageUpload").addEventListener("change", async function(){
  const file = this.files[0];
  if(!file) return;

  const confidenceThreshold = 0.6; // 60%
  document.getElementById("spinner").classList.remove("d-none");
  let dots = 0;
  const msgInterval = setInterval(()=>{
    dots = (dots + 1) % 4;
    document.getElementById("scanText").innerText = "Searching under the pond leaves ğŸŒ¿" + ".".repeat(dots);
  }, 500);

  const resultCard = document.getElementById("result");
  resultCard.classList.remove("show");
  resultCard.classList.add("d-none");

  const img = new Image();
  img.src = URL.createObjectURL(file);
  img.onload = async () => {
    try {
      const prediction = await model.predict(img);
      const topPred = prediction.reduce((a,b)=>a.probability>b.probability?a:b);
      clearInterval(msgInterval);
      document.getElementById("spinner").classList.add("d-none");

      let algaeKey = null;
      if(topPred.probability >= confidenceThreshold){
        algaeKey = Object.keys(algaeInfo).find(
          key => topPred.className.toLowerCase().includes(key.toLowerCase())
        );
      }

      if(algaeKey){
        document.getElementById("predictedName").innerText = topPred.className;
        document.getElementById("confidence").innerText = "Confidence: " + (topPred.probability*100).toFixed(2) + "%";
        document.getElementById("description").innerText = algaeInfo[algaeKey].description;
      } else {
        document.getElementById("predictedName").innerText = "";
        document.getElementById("confidence").innerText = "Confidence: " + (topPred.probability*100).toFixed(2) + "%";
        document.getElementById("description").innerText = "This algae is not yet recognized in our pond ğŸŒ±. If you know it, please contribute!";
      }

      resultCard.classList.remove("d-none");
      setTimeout(()=>{resultCard.classList.add("show");}, 50);
      document.getElementById("scanText").innerText = "Prediction complete! ğŸŒ¿";

    } catch(err){
      clearInterval(msgInterval);
      document.getElementById("spinner").classList.add("d-none");
      console.error("Prediction error:", err);
      document.getElementById("scanText").innerText = "Failed to predict. Check console.";
    }
  }
});

// Generate bubbles dynamically
function createBubbles() {
  const bubblesContainer = document.getElementById("bubbles");
  for(let i=0;i<20;i++){
    const bubble = document.createElement("div");
    bubble.className = "bubble";
    bubble.style.left = Math.random()*window.innerWidth+"px";
    bubble.style.width = (5+Math.random()*10)+"px";
    bubble.style.height = bubble.style.width;
    bubble.style.animationDuration = (3+Math.random()*5)+"s";
    bubble.style.opacity = 0.5 + Math.random()*0.5;
    bubblesContainer.appendChild(bubble);
  }
}
createBubbles();
</script>
</body>
</html>
