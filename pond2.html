<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pond 2 ‚Ä¢ UniqueSeeker‚Äôs Algae Pond</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>

<style>
  :root{
    /* Locked Pond 2 water palette */
    --waterA:#5FC2A7;   /* surface */
    --waterB:#3CC19E;   /* mid */
    --waterC:#148B86;   /* deep */

    --glass: rgba(255,255,255,0.12);
    --glass2: rgba(255,255,255,0.18);
    --border: rgba(255,255,255,0.22);
    --text: rgba(255,255,255,0.92);
    --shadow: 0 18px 45px rgba(0,0,0,0.30);
  }

  html,body{margin:0;height:100%;font-family:Poppins,system-ui,Arial;overflow-x:hidden;background:#051b1a;}
  body{position:relative;color:var(--text);}

  /* ====== BACKGROUND (SURFACE + UNDERWATER) ====== */
  .pond-bg{
    position:fixed; inset:0;
    z-index:0;
    overflow:hidden;
    background: linear-gradient(to bottom,
      var(--waterA) 0%,
      var(--waterB) 45%,
      var(--waterC) 100%);
  }

  /* Soft water shimmer (no hard line) */
  .pond-bg::before{
    content:"";
    position:absolute; inset:-20%;
    background:
      radial-gradient(1200px 500px at 50% 20%, rgba(255,255,255,0.22), transparent 60%),
      radial-gradient(900px 350px at 20% 30%, rgba(255,255,255,0.12), transparent 55%),
      radial-gradient(900px 350px at 80% 35%, rgba(255,255,255,0.10), transparent 55%),
      linear-gradient(to bottom, rgba(255,255,255,0.18), rgba(255,255,255,0.03) 35%, transparent 70%);
    filter: blur(0.5px);
    opacity: 0.85;
    animation: shimmer 7s ease-in-out infinite alternate;
    pointer-events:none;
  }

  /* Light rays */
  .pond-bg::after{
    content:"";
    position:absolute; inset:0;
    background:
      linear-gradient(110deg, transparent 0%, rgba(255,255,255,0.08) 30%, transparent 55%),
      linear-gradient(75deg, transparent 0%, rgba(255,255,255,0.06) 35%, transparent 60%);
    mix-blend-mode: overlay;
    opacity:0.55;
    transform: translateY(-10px);
    animation: rays 9s ease-in-out infinite;
    pointer-events:none;
  }

  @keyframes shimmer{
    from{ transform: translate3d(-1.2%, -0.6%, 0) scale(1.01); }
    to  { transform: translate3d(1.2%, 0.6%, 0) scale(1.02); }
  }
  @keyframes rays{
    0%,100%{ transform: translateY(-10px) translateX(-10px); opacity:0.45; }
    50%    { transform: translateY(10px) translateX(10px);  opacity:0.65; }
  }

  /* Water surface band (subtle, not a hard line) */
  .surface-band{
    position:absolute; left:0; right:0;
    top: 18vh;
    height: 10vh;
    background: linear-gradient(to bottom,
      rgba(255,255,255,0.22),
      rgba(255,255,255,0.10),
      rgba(255,255,255,0.03),
      transparent);
    filter: blur(0.2px);
    opacity:0.85;
    pointer-events:none;
  }
  .surface-wave{
    position:absolute; left:-10%; right:-10%;
    top: 19vh;
    height: 7vh;
    background:
      radial-gradient(120px 18px at 10% 60%, rgba(255,255,255,0.18), transparent 70%),
      radial-gradient(150px 22px at 35% 40%, rgba(255,255,255,0.14), transparent 72%),
      radial-gradient(140px 20px at 60% 65%, rgba(255,255,255,0.13), transparent 72%),
      radial-gradient(140px 20px at 85% 45%, rgba(255,255,255,0.12), transparent 72%);
    animation: surfaceMove 6s ease-in-out infinite alternate;
    opacity:0.7;
    pointer-events:none;
  }
  @keyframes surfaceMove{
    from{ transform: translateX(-1.5%); }
    to  { transform: translateX(1.5%); }
  }

  /* ====== TOP HUD ====== */
  .topbar{
    position:fixed; left:14px; right:14px; top:12px;
    display:flex; align-items:center; justify-content:space-between;
    gap:10px;
    z-index:20;
    pointer-events:none;
  }
  .pill{
    pointer-events:auto;
    background: rgba(0,0,0,0.28);
    border: 1px solid rgba(255,255,255,0.18);
    border-radius: 999px;
    padding: 10px 14px;
    backdrop-filter: blur(10px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.22);
    display:flex; align-items:center; gap:10px;
    font-weight:600;
  }
  .right-pills{ display:flex; gap:10px; }

  .pill a, .pill button{
    all:unset;
    cursor:pointer;
    color:var(--text);
    font-weight:700;
  }

  /* ====== INTRO TEXT (FADE IN THEN OUT) ====== */
  .intro{
    position:fixed; inset:0;
    z-index:15;
    display:flex; align-items:flex-start; justify-content:center;
    padding-top: 62px;
    pointer-events:none;
  }
  .intro .stack{
    text-align:center;
    opacity:0;
    transform: translateY(8px);
    animation: introShow 5.2s ease forwards;
  }
  .intro h1{
    margin:0;
    font-size: clamp(22px, 3.5vw, 42px);
    letter-spacing: 0.5px;
    text-shadow: 0 10px 25px rgba(0,0,0,0.25);
  }
  .intro p{
    margin:10px 0 0;
    font-size: clamp(13px, 2.0vw, 18px);
    opacity:0.92;
    text-shadow: 0 10px 25px rgba(0,0,0,0.20);
  }
  @keyframes introShow{
    0%   { opacity:0; transform: translateY(10px); }
    18%  { opacity:1; transform: translateY(0); }
    75%  { opacity:1; }
    100% { opacity:0; transform: translateY(-6px); }
  }

  /* ====== UI CARDS ====== */
  .ui-wrap{
    position:relative;
    z-index:10;
    padding: 110px 14px 40px;
    display:flex;
    justify-content:center;
  }
  .panel{
    width:min(980px, 100%);
    display:grid;
    grid-template-columns: 1.15fr 0.85fr;
    gap:16px;
    align-items:start;
  }

  .card{
    background: var(--glass);
    border: 1px solid var(--border);
    border-radius: 18px;
    padding: 16px;
    backdrop-filter: blur(10px);
    box-shadow: var(--shadow);
  }

  .upload-box{
    background: rgba(255,255,255,0.14);
    border: 1px solid rgba(255,255,255,0.18);
    padding: 16px;
    border-radius: 14px;
    cursor:pointer;
    transition: transform 0.15s ease, background 0.2s ease;
    font-weight:700;
  }
  .upload-box:hover{ transform: translateY(-1px); background: rgba(255,255,255,0.18); }

  #prediction{ margin:12px 0 6px; font-size: 15px; }
  .description{ font-size: 13px; line-height: 1.55; opacity:0.95; }
  .description h3{ margin: 10px 0 6px; font-size: 13px; }
  .description ul{ margin: 0 0 0 18px; padding:0; }

  .carousel{ margin-top:10px; position:relative; width:100%; max-width:220px; }
  .carousel img{ width:100%; border-radius:14px; display:none; border:1px solid rgba(255,255,255,0.20); }
  .carousel img.active{ display:block; }
  .carousel button{
    position:absolute; top:50%; transform:translateY(-50%);
    background: rgba(0,0,0,0.25);
    border:1px solid rgba(255,255,255,0.16);
    color:white;
    font-size:18px;
    padding:6px 10px;
    cursor:pointer;
    border-radius:10px;
  }
  .prev{ left:6px; } .next{ right:6px; }

  .stars span{
    font-size:28px; cursor:pointer; color:rgba(255,255,255,0.40);
    display:inline-block; transition: transform 0.2s ease, color 0.2s ease;
  }
  .stars span.filled{ color: #ffd35a; transform: scale(1.08); }
  .thank-message{ margin-top:10px; min-height:24px; font-size: 13px; opacity:0.95; }

  .btn{
    width:100%;
    margin-top:10px;
    padding: 11px 12px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.18);
    cursor:pointer;
    font-weight:800;
    letter-spacing: 0.2px;
    background: rgba(0,0,0,0.22);
    color: var(--text);
    backdrop-filter: blur(8px);
    transition: transform 0.15s ease, background 0.2s ease;
  }
  .btn:hover{ transform: translateY(-1px); background: rgba(0,0,0,0.28); }
  .btn.primary{ background: rgba(39,174,96,0.45); }
  .btn.primary:hover{ background: rgba(39,174,96,0.55); }
  .btn.blue{ background: rgba(41,128,185,0.45); }
  .btn.blue:hover{ background: rgba(41,128,185,0.55); }

  @media (max-width: 860px){
    .panel{ grid-template-columns: 1fr; }
    .ui-wrap{ padding-top: 98px; }
  }

  /* ====== ANIME FISH (LIGHTWEIGHT) ====== */
  .fish{
    position:fixed;
    width:58px; height:28px;
    z-index:6;
    pointer-events:none;
    will-change: transform;
    filter: drop-shadow(0 10px 18px rgba(0,0,0,0.18));
  }
  .fish .body{
    position:absolute; inset:0;
    border-radius: 999px;
    background: var(--c);
    box-shadow: inset 0 3px 0 rgba(255,255,255,0.22);
  }
  .fish .tail{
    position:absolute; top:6px;
    width:18px; height:16px;
    background: var(--c);
    border-radius: 4px;
    clip-path: polygon(0 50%, 100% 0, 100% 100%);
    opacity:0.95;
  }
  .fish .fin{
    position:absolute;
    width:14px; height:10px;
    background: rgba(255,255,255,0.18);
    border: 1px solid rgba(255,255,255,0.18);
    border-radius: 10px 10px 10px 0;
    top: 7px;
    left: 22px;
    transform: rotate(-8deg);
  }
  .fish .eye{
    position:absolute; top:10px;
    width:6px; height:6px; border-radius:50%;
    background: rgba(0,0,0,0.55);
    box-shadow: 0 0 0 2px rgba(255,255,255,0.28);
  }

  .fish.right .tail{ left:-10px; transform: scaleX(1); }
  .fish.right .eye{ right:12px; }
  .fish.left{ transform: scaleX(-1); } /* flip whole fish */
  .fish.left .tail{ left:-10px; }
  .fish.left .eye{ right:12px; }

  /* ====== LOTUS PAD + FROG (SURFACE ONLY) ====== */
  .surface-layer{
    position:fixed;
    left:0; right:0;
    top: 11vh;
    height: 18vh;
    z-index:7;
    pointer-events:none;
  }

  .pad{
    position:absolute;
    width: 180px;
    height: 70px;
    border-radius: 999px;
    background: linear-gradient(to bottom, rgba(62,198,145,0.95), rgba(22,130,96,0.95));
    box-shadow: 0 18px 40px rgba(0,0,0,0.20);
    border: 1px solid rgba(255,255,255,0.22);
    filter: saturate(1.05);
    animation: padBob 4.8s ease-in-out infinite;
  }
  .pad::after{
    /* notch */
    content:"";
    position:absolute;
    right: 22px; top: 24px;
    width: 30px; height: 26px;
    background: rgba(0,0,0,0.0);
    border-radius: 100px;
    box-shadow: inset -18px 0 0 rgba(0,0,0,0.12);
    transform: rotate(12deg);
    opacity:0.7;
  }
  @keyframes padBob{
    0%,100%{ transform: translateY(0) rotate(-0.6deg); }
    50%{ transform: translateY(4px) rotate(0.6deg); }
  }

  .frog{
    position:absolute;
    width: 70px; height: 46px;
    left: 50%; top: 10px;
    transform: translateX(-50%);
    background: linear-gradient(to bottom, #86efac, #22c55e);
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.22);
    box-shadow: 0 14px 28px rgba(0,0,0,0.18);
  }
  .frog::before, .frog::after{
    content:"";
    position:absolute;
    width:14px; height:14px;
    background:#eafff2;
    border-radius:50%;
    top:-6px;
    box-shadow: inset 0 -3px 0 rgba(0,0,0,0.10);
  }
  .frog::before{ left: 14px; }
  .frog::after{ right: 14px; }
  .frog .pupil{
    position:absolute;
    width:6px; height:6px;
    background: rgba(0,0,0,0.55);
    border-radius:50%;
    top: 3px;
  }
  .frog .pupil.l{ left: 20px; }
  .frog .pupil.r{ right: 20px; }

  /* frog head turn (more frequent) */
  .frog-turn{
    animation: frogTurn 2.6s ease-in-out infinite;
    transform-origin: center;
  }
  @keyframes frogTurn{
    0%,100%{ transform: translateX(-50%) rotate(0deg); }
    40%{ transform: translateX(-50%) rotate(3deg); }
    65%{ transform: translateX(-50%) rotate(-3deg); }
  }

  /* ====== SEAWEED (SIDES / BOTTOM) ====== */
  .seaweed{
    position:fixed;
    bottom:-12px;
    width: 20px;
    height: 220px;
    border-radius: 18px 18px 10px 10px;
    background: linear-gradient(to top, rgba(6,92,73,0.95), rgba(35,170,125,0.85));
    filter: blur(0.0px);
    opacity:0.95;
    z-index:3;
    transform-origin: bottom center;
    animation: weedSway 3.5s ease-in-out infinite alternate;
  }
  @keyframes weedSway{
    from{ transform: rotate(-4deg); }
    to  { transform: rotate(4deg); }
  }

  /* ====== BUBBLES (LIGHTWEIGHT) ====== */
  .bubble{
    position:fixed;
    width: 12px; height: 12px;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.90), rgba(255,255,255,0.12));
    box-shadow: 0 0 14px rgba(255,255,255,0.25);
    z-index:4;
    pointer-events:auto;
    will-change: transform;
    opacity:0.85;
  }

  /* click/tap pop */
  .bubble.pop{ animation: pop 0.25s ease forwards !important; }
  @keyframes pop{
    to{ transform: scale(2.0); opacity:0; }
  }

  /* ====== TOUCH RIPPLE (UNDERWATER ONLY) ====== */
  .touch-ripple{
    position:fixed;
    width: 18px; height: 18px;
    border: 2px solid rgba(255,255,255,0.35);
    border-radius: 50%;
    pointer-events:none;
    z-index:5;
    transform: translate(-50%, -50%) scale(0.7);
    opacity: 0.75;
    animation: ripple 0.9s ease-out forwards;
  }
  @keyframes ripple{
    to{ transform: translate(-50%, -50%) scale(2.8); opacity:0; }
  }
</style>
</head>

<body>
  <div class="pond-bg">
    <div class="surface-band"></div>
    <div class="surface-wave"></div>
  </div>

  <div class="topbar">
    <div class="pill">üåø UniqueSeeker‚Äôs Algae Pond ‚Ä¢ Pond 2</div>
    <div class="right-pills">
      <div class="pill"><a href="./index.html">Pond 1</a></div>
      <div class="pill"><button id="pond2Btn">Pond 2</button></div>
    </div>
  </div>

  <div class="intro">
    <div class="stack">
      <h1>Welcome to Uniqueseeker‚Äôs Algal Pond</h1>
      <p>See if your algae is already here. Or help the journal grow.</p>
    </div>
  </div>

  <!-- Surface layer objects -->
  <div class="surface-layer" id="surfaceLayer"></div>

  <!-- UI -->
  <div class="ui-wrap">
    <div class="panel">
      <div class="card">
        <div class="upload-box" id="uploadBox">üåø Select your algae photo to start!</div>
        <input type="file" id="imageUpload" accept="image/*" style="display:none;">
        <div id="prediction"></div>
        <div class="carousel" id="carousel"></div>
        <div id="description" class="description"></div>
      </div>

      <div class="card" style="text-align:center;">
        <div class="stars" id="stars"></div>
        <div class="thank-message" id="thankMessage"></div>
        <button class="btn primary contribute">Contribute üì®</button>
        <button class="btn blue explore">Explore Algae Around the World üåè</button>
      </div>
    </div>
  </div>

<script>
/* ===================== MODEL ===================== */
let model;
let classes = [];
const CONFIDENCE_THRESHOLD = 0.65;

// Algae info (unchanged)
const algaeInfo = {
  "spirogyra": {images:["images/spirogyra1.jpg","images/spirogyra2.jpg"], habit:["Filamentous freshwater green algae","Forms floating slimy masses","Has spiral chloroplasts"], economic:["Produces oxygen in ponds","Used in biological research"], location:["Found in freshwater ponds","Common in slow-moving water bodies"]},
  "cladophora": {images:["images/cladophora1.jpg","images/cladophora2.jpg","images/cladophora3.jpg"], habit:["Branched filamentous green algae","Attaches to submerged surfaces","Forms dense green mats"], economic:["Provides shelter for aquatic organisms","Indicates nutrient pollution levels"], location:["Freshwater & marine habitats","Common in nutrient-rich environments"]},
  "oedogonium": {images:["images/oedogonium1.jpg","images/oedogonium2.jpg"], habit:["Filamentous green algae with basal holdfast","Grows in mats or attached filaments","Prefers calm water"], economic:["Used in research and water quality monitoring","Oxygen producer in water bodies"], location:["Freshwater ponds and slow streams","Common in nutrient-rich ponds"]},
  "volvox": {images:["images/volvox1.jpg","images/volvox2.jpg"], habit:["Spherical colonial green algae","Colonies with flagella","Forms motile spheres"], economic:["Used in biological experiments","Oxygen producer"], location:["Freshwater ponds and lakes","Common in nutrient-rich water"]},
  "nostoc": {images:["images/nostoc1.jpg","images/nostoc2.jpg"], habit:["Cyanobacteria forming colonies","Gelatinous colonies","Filamentous structure"], economic:["Nitrogen fixation","Used in research"], location:["Freshwater and moist soils","Found on rocks and soil surfaces"]},
  "pediastrum": {images:["images/pediastrum1.jpg","images/pediastrum2.jpg"], habit:["Colonial green algae","Flat star-like colonies","Planktonic in water"], economic:["Used in ecological studies","Indicator of water quality"], location:["Freshwater ponds","Common in nutrient-rich water"]},
  "cosmarium": {images:["images/cosmarium1.jpg","images/cosmarium2.jpg"], habit:["Single-celled green algae with semicells","Desmids are symmetrical","Often found in colonies"], economic:["Used in ecological studies","Indicator of water quality"], location:["Freshwater habitats","Ponds and lakes with clean water"]},
  "noctiluca": {images:["images/noctiluca1.jpg","images/noctiluca2.jpg"], habit:["Bioluminescent marine plankton","Single-celled","Motile with flagella"], economic:["Indicators of marine water health","Can cause red tides"], location:["Marine environments","Coastal waters worldwide"]},
  "staurastrum": {images:["images/staurastrum1.jpg","images/staurastrum2.jpg"], habit:["Single-celled desmid","Star-shaped cells","Free-floating"], economic:["Used in water quality studies","Indicator species"], location:["Freshwater ponds","Clean, slow-moving waters"]},
  "scenedesmus": {images:["images/scenedesmus1.jpg","images/scenedesmus2.jpg"], habit:["Colonial green algae","Forms four-cell colonies","Common planktonic algae"], economic:["Used in biofuel research","Indicator of water quality"], location:["Freshwater ponds","Often in nutrient-rich waters"]}
};

async function loadModel(){
  model = await tf.loadLayersModel("my_model/model.json");
  const metadata = await fetch("my_model/metadata.json").then(res=>res.json());
  classes = metadata.labels.map(l => l.trim().toLowerCase());
}
loadModel();

/* ===================== UI ===================== */
const uploadBox = document.getElementById("uploadBox");
const imageUpload = document.getElementById("imageUpload");
uploadBox.addEventListener("click", ()=> imageUpload.click());

/* Stars */
const starsContainer = document.getElementById("stars");
const thankMessage = document.getElementById("thankMessage");
let rating = 0;
function renderStars(){
  starsContainer.innerHTML="";
  for(let i=1;i<=5;i++){
    const star=document.createElement("span");
    star.innerHTML = (i<=rating) ? "‚òÖ" : "‚òÜ";
    if(i<=rating) star.classList.add("filled");
    star.onclick=()=> rateStar(i);
    star.addEventListener("touchstart",()=> rateStar(i), {passive:true});
    starsContainer.appendChild(star);
  }
}
function rateStar(i){
  rating=i; renderStars();
  const messages={1:"üò¢ We'll improve! Thanks!",2:"üôÇ Thank you! We‚Äôll grow!",3:"üòä Nice! Thanks!",4:"üåü Awesome! You‚Äôre amazing!",5:"üòç WOW! You love our pond!"};
  thankMessage.innerText=messages[i];
}
renderStars();

/* Carousel */
function createCarousel(images){
  const carouselDiv=document.getElementById("carousel");
  carouselDiv.innerHTML="";
  if(!images || images.length===0) return;

  images.forEach((src,i)=>{
    const img=document.createElement("img");
    img.src=src;
    if(i===0) img.classList.add("active");
    carouselDiv.appendChild(img);
  });

  const prevBtn=document.createElement("button");
  prevBtn.className="prev"; prevBtn.innerHTML="&#10094;"; prevBtn.onclick=()=> moveSlide(-1);
  const nextBtn=document.createElement("button");
  nextBtn.className="next"; nextBtn.innerHTML="&#10095;"; nextBtn.onclick=()=> moveSlide(1);
  carouselDiv.appendChild(prevBtn);
  carouselDiv.appendChild(nextBtn);
  carouselDiv.currentIndex=0;
}
function moveSlide(dir){
  const carouselDiv=document.getElementById("carousel");
  const imgs=carouselDiv.querySelectorAll("img");
  if(!imgs.length) return;
  imgs[carouselDiv.currentIndex].classList.remove("active");
  carouselDiv.currentIndex=(carouselDiv.currentIndex+dir+imgs.length)%imgs.length;
  imgs[carouselDiv.currentIndex].classList.add("active");
}

/* Prediction */
imageUpload.addEventListener("change", async (event)=>{
  const file = event.target.files[0];
  if(!file) return;

  const img = new Image();
  img.src = URL.createObjectURL(file);

  img.onload = async ()=>{
    const tensor = tf.browser.fromPixels(img)
      .resizeNearestNeighbor([224,224])
      .toFloat().div(255.0).expandDims();

    const prediction = model.predict(tensor);
    const data = await prediction.data();
    const maxValue = Math.max(...data);
    const index = data.indexOf(maxValue);
    const predictedClass = classes[index];
    const confidence = (maxValue*100).toFixed(2);

    const predictionText=document.getElementById("prediction");
    const descriptionBox=document.getElementById("description");
    const info = algaeInfo[predictedClass] || algaeInfo[(predictedClass||"").toLowerCase()];

    if((predictedClass||"").toLowerCase() === "unknown algae"){
      predictionText.innerHTML = "Prediction: <b>Unknown Algae</b>";
      descriptionBox.innerHTML = "<h3>üêüüåø Not yet in the pond!</h3><p>If you know it, please contribute a photo üå±üíö</p>";
      createCarousel([]);
      return;
    }

    if(maxValue >= CONFIDENCE_THRESHOLD && info){
      predictionText.innerHTML = `Prediction: <b>${predictedClass.charAt(0).toUpperCase()+predictedClass.slice(1)}</b><br>Confidence: ${confidence}%`;
      createCarousel(info.images);
      descriptionBox.innerHTML =
        "<h3>Habit</h3><ul>"+info.habit.map(x=>"<li>"+x+"</li>").join("")+"</ul>"+
        "<h3>Economic Importance</h3><ul>"+info.economic.map(x=>"<li>"+x+"</li>").join("")+"</ul>"+
        "<h3>Location</h3><ul>"+info.location.map(x=>"<li>"+x+"</li>").join("")+"</ul>";
    } else {
      predictionText.innerHTML = `Confidence: ${confidence}%`;
      createCarousel([]);
      descriptionBox.innerHTML="<h3>üêüüåø Not yet in the pond!</h3><p>Hmm‚Ä¶ this algae is not yet in our pond. If you know it, please contribute üå±üíö</p>";
    }

    // cleanup tensor
    tensor.dispose();
    prediction.dispose();
  };
});

/* Buttons */
document.querySelector(".contribute").addEventListener("click",()=>{
  const email="uniqueseeekers123@gmail.com";
  const subject=encodeURIComponent("Algae Contribution üåø");
  const body=encodeURIComponent("Hello! I want to contribute an algae image or info to your pond project.");
  if(window.innerWidth>768){
    alert(`üíö Thanks for contributing!\nSend images/info to: ${email}`);
  }else{
    window.location.href=`mailto:${email}?subject=${subject}&body=${body}`;
  }
});
document.querySelector(".explore").addEventListener("click",()=>{
  alert("üåé Global algae exploration coming soon!");
});

/* ===================== POND VISUALS (LIGHT) ===================== */

/* Surface objects */
const surfaceLayer = document.getElementById("surfaceLayer");

// one pad + one lotus + one frog (as you asked)
function buildSurface(){
  surfaceLayer.innerHTML = "";

  const pad = document.createElement("div");
  pad.className = "pad";
  pad.style.left = "14%";
  pad.style.top  = "5vh";

  const frog = document.createElement("div");
  frog.className = "frog frog-turn";
  frog.innerHTML = `<div class="pupil l"></div><div class="pupil r"></div>`;
  pad.appendChild(frog);

  surfaceLayer.appendChild(pad);

  const pad2 = document.createElement("div");
  pad2.className = "pad";
  pad2.style.left = "64%";
  pad2.style.top  = "6.6vh";
  pad2.style.opacity = "0.95";
  surfaceLayer.appendChild(pad2);
}
buildSurface();

/* Seaweed sides */
function buildSeaweed(){
  // remove old
  document.querySelectorAll(".seaweed").forEach(n=>n.remove());

  const positions = [
    {x: "2%",  h: 210, d: "0s"},
    {x: "6%",  h: 260, d: "0.6s"},
    {x: "10%", h: 230, d: "1.1s"},
    {x: "90%", h: 240, d: "0.4s"},
    {x: "94%", h: 280, d: "1.0s"},
    {x: "98%", h: 220, d: "1.5s"}
  ];
  positions.forEach(p=>{
    const w = document.createElement("div");
    w.className = "seaweed";
    w.style.left = p.x;
    w.style.height = p.h+"px";
    w.style.animationDelay = p.d;
    document.body.appendChild(w);
  });
}
buildSeaweed();

/* Fish (4 only, underwater region only) */
function makeFish(color, dir){
  const f = document.createElement("div");
  f.className = "fish " + dir;
  f.style.setProperty("--c", color);
  f.innerHTML = `<div class="body"></div><div class="tail"></div><div class="fin"></div><div class="eye"></div>`;
  document.body.appendChild(f);
  return f;
}

const fishList = [
  {c:"#ffb74a", dir:"right"},
  {c:"#ff6b6b", dir:"left"},
  {c:"#ffd966", dir:"right"},
  {c:"#7dd3fc", dir:"left"},
];

const fishEls = fishList.map(x=>makeFish(x.c, x.dir));

/* Animation loop (single rAF = smooth + low CPU) */
let t0 = performance.now();

function animate(now){
  const dt = (now - t0) / 1000;
  t0 = now;

  const vh = window.innerHeight;

  // underwater zone starts after surface band (rough)
  const minY = Math.floor(vh * 0.35);
  const maxY = Math.floor(vh * 0.80);

  fishEls.forEach((f, i)=>{
    const speed = 0.05 + i*0.012;
    const baseY = minY + ((maxY-minY) * (0.15 + i*0.22));
    const bob = Math.sin(now/900 + i) * 6;

    // horizontal travel: wrap
    const W = window.innerWidth + 140;
    const offset = (now * speed) % W;

    if(f.classList.contains("right")){
      const x = -120 + offset;
      f.style.transform = `translate3d(${x}px, ${baseY + bob}px, 0)`;
    }else{
      const x = (window.innerWidth + 120) - offset;
      // left fish is flipped via CSS scaleX(-1), so translate is still normal
      f.style.transform = `translate3d(${x}px, ${baseY + bob}px, 0) scaleX(-1)`;
    }
  });

  requestAnimationFrame(animate);
}
requestAnimationFrame(animate);

/* Bubbles (reduced + light) */
const MAX_BUBBLES = 10;
function spawnBubble(){
  const b = document.createElement("div");
  b.className = "bubble";

  const size = 8 + Math.random()*10;
  b.style.width = size+"px";
  b.style.height = size+"px";
  b.style.left = (Math.random()*window.innerWidth) + "px";

  // start underwater
  b.style.top = (window.innerHeight * (0.45 + Math.random()*0.55)) + "px";

  const duration = 7 + Math.random()*6;
  const drift = (Math.random()*60 - 30);

  const startY = parseFloat(b.style.top);
  const startX = parseFloat(b.style.left);
  const start = performance.now();

  function step(now){
    const p = (now - start) / (duration*1000);
    if(p >= 1){
      b.remove();
      return;
    }
    const y = startY - p * (window.innerHeight * 0.70);
    const x = startX + drift * Math.sin(p*3.14);
    b.style.transform = `translate3d(${x-startX}px, ${y-startY}px, 0)`;
    b.style.opacity = (1 - p) * 0.85;
    requestAnimationFrame(step);
  }
  requestAnimationFrame(step);

  // pop interaction
  b.addEventListener("click", ()=>{ b.classList.add("pop"); setTimeout(()=>b.remove(), 220); });
  b.addEventListener("touchstart", ()=>{ b.classList.add("pop"); setTimeout(()=>b.remove(), 220); }, {passive:true});

  document.body.appendChild(b);
}

function bubbleLoop(){
  const current = document.querySelectorAll(".bubble").length;
  if(current < MAX_BUBBLES){
    for(let i=0;i<(MAX_BUBBLES-current);i++) spawnBubble();
  }
  setTimeout(bubbleLoop, 1200);
}
bubbleLoop();

/* Underwater ripples only (not on cards) */
function isUnderwater(y){
  return y > window.innerHeight * 0.35;
}
function makeRipple(x,y){
  const r = document.createElement("div");
  r.className="touch-ripple";
  r.style.left = x+"px";
  r.style.top = y+"px";
  document.body.appendChild(r);
  setTimeout(()=>r.remove(), 900);
}
document.addEventListener("pointerdown",(e)=>{
  if(!isUnderwater(e.clientY)) return;
  if(e.target.closest(".card, button, input, .upload-box, .carousel")) return;
  makeRipple(e.clientX, e.clientY);
});
</script>
</body>
</html>
